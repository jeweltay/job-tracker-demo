<!DOCTYPE html>
<html>
<head>
    <title>Job Applications - Search & Filter</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            max-width: 1400px; 
            margin: 0 auto; 
            padding: 20px; 
            background-color: #f5f5f5;
        }
        .header { 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            margin-bottom: 20px;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .filters-section {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .filter-row {
            display: flex;
            gap: 15px;
            align-items: center;
            flex-wrap: wrap;
            margin-bottom: 15px;
        }
        .filter-group {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .search-box {
            flex: 1;
            min-width: 250px;
        }
        .search-input, .filter-select {
            padding: 10px 12px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
        }
        .search-input {
            width: 100%;
        }
        .btn { 
            padding: 10px 20px; 
            border: none; 
            border-radius: 5px; 
            cursor: pointer; 
            text-decoration: none;
            display: inline-block;
            font-size: 14px;
        }
        .btn-primary { 
            background-color: #2196F3; 
            color: white; 
        }
        .btn-secondary { 
            background-color: #6c757d; 
            color: white; 
        }
        .btn-add { 
            background-color: #2196F3; 
            color: white; 
            padding: 10px 20px; 
        }
        .btn-clear {
            background-color: #ff6b6b;
            color: white;
        }
        table { 
            border-collapse: collapse; 
            width: 100%; 
            margin: 20px 0; 
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        th, td { 
            border: 1px solid #ddd; 
            padding: 12px; 
            text-align: left; 
        }
        th { 
            background-color: #f2f2f2; 
            position: sticky; 
            top: 0; 
            font-weight: bold;
        }
        tr:hover { 
            background-color: #f5f5f5; 
        }
        .actions { 
            white-space: nowrap; 
        }
        .btn-edit { 
            background-color: #4CAF50; 
            color: white; 
            padding: 6px 12px;
            font-size: 12px;
        }
        .btn-delete { 
            background-color: #f44336; 
            color: white; 
            padding: 6px 12px;
            font-size: 12px;
        }
        .total-score { 
            font-weight: bold; 
            color: #2c3e50; 
        }
        .notes { 
            max-width: 200px; 
            overflow: hidden; 
            text-overflow: ellipsis; 
            white-space: nowrap; 
        }
        .results-info {
            background: #e8f5e8;
            padding: 10px 15px;
            border-radius: 5px;
            margin: 10px 0;
            border-left: 4px solid #4CAF50;
        }
        .active-filter {
            background: #2196F3;
            color: white;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            margin: 0 2px;
        }
    </style>
</head>
<body>
    <!-- Demo Banner -->
    <div class="demo-banner" style="background: #ffeb3b; color: #333; padding: 10px; text-align: center; border-bottom: 2px solid #ffc107;">
        <strong>PUBLIC DEMO</strong> - All data is sample data. Feel free to test features. Changes will be simulated but not saved.
    </div>

    <!-- Flash Messages -->
    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        <div class="flash-messages">
          {% for category, message in messages %}
            <div class="alert alert-{{ category }}">{{ message }}</div>
          {% endfor %}
        </div>
      {% endif %}
    {% endwith %}

    <!-- Add this CSS for flash messages -->
    <style>
    .flash-messages {
        margin: 10px;
    }

    .alert {
        padding: 12px;
        border-radius: 4px;
        margin: 10px 0;
        border: 1px solid transparent;
    }

    .alert-success {
        background-color: #d4edda;
        color: #155724;
        border-color: #c3e6cb;
    }

    .alert-error {
        background-color: #f8d7da;
        color: #721c24;
        border-color: #f5c6cb;
    }
    </style>

    <div class="header">
        <h1>Job Applications - Search & Filter</h1>
        <div>
            <a href="/dashboard" class="btn btn-add" style="margin-right: 10px;">ðŸ“Š Analytics Dashboard</a>
            <a href="/add" class="btn btn-add">+ Add New Job</a>
        </div>
    </div>
    <div class="nav-buttons">
        <a href="/add" class="btn">+ Add New Job</a>
        <a href="/export-jobs" class="btn">Export to CSV</a>
    </div>

    <!-- Search & Filters Section -->
    <div class="filters-section">
        <form method="GET" action="/">
            <div class="filter-row">
                <div class="filter-group search-box">
                    <input type="text" 
                           name="search" 
                           class="search-input" 
                           placeholder="Search companies, job titles, or tags..."
                           value="{{ search_query }}">
                </div>
                
                <div class="filter-group">
                    <select name="status" class="filter-select">
                        <option value="all">All Statuses</option>
                        {% for status in status_options %}
                        <option value="{{ status }}" {% if status == status_filter %}selected{% endif %}>
                            {{ status }}
                        </option>
                        {% endfor %}
                    </select>
                </div>
                
                <div class="filter-group">
                    <select name="score" class="filter-select">
                        <option value="all">All Scores</option>
                        <option value="high" {% if score_filter == 'high' %}selected{% endif %}>High (4.0+)</option>
                        <option value="medium" {% if score_filter == 'medium' %}selected{% endif %}>Medium (2.5-3.9)</option>
                        <option value="low" {% if score_filter == 'low' %}selected{% endif %}>Low (0-2.4)</option>
                    </select>
                </div>
                
                <div class="filter-group">
                    <select name="sort" class="filter-select">
                        <option value="newest" {% if sort_by == 'newest' %}selected{% endif %}>Newest First</option>
                        <option value="oldest" {% if sort_by == 'oldest' %}selected{% endif %}>Oldest First</option>
                        <option value="highest_score" {% if sort_by == 'highest_score' %}selected{% endif %}>Highest Score</option>
                        <option value="lowest_score" {% if sort_by == 'lowest_score' %}selected{% endif %}>Lowest Score</option>
                        <option value="company" {% if sort_by == 'company' %}selected{% endif %}>Company A-Z</option>
                    </select>
                </div>
                
                <button type="submit" class="btn btn-primary">Apply Filters</button>
                <a href="/" class="btn btn-clear">Clear All</a>
            </div>
        </form>

        <!-- Active Filters Display -->
        {% if search_query or status_filter != 'all' or score_filter != 'all' %}
        <div class="results-info">
            <strong>Showing {{ jobs|length }} of {{ total_jobs }} jobs</strong>
            {% if search_query %}
                <span class="active-filter">Search: "{{ search_query }}"</span>
            {% endif %}
            {% if status_filter != 'all' %}
                <span class="active-filter">Status: {{ status_filter }}</span>
            {% endif %}
            {% if score_filter != 'all' %}
                <span class="active-filter">Score: {{ score_filter }}</span>
            {% endif %}
            {% if sort_by != 'newest' %}
                <span class="active-filter">Sorted by: {{ sort_by.replace('_', ' ') }}</span>
            {% endif %}
        </div>
        {% endif %}
    </div>

    <!-- Jobs Table -->
    {% if jobs %}
        <table>
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Company</th>
                    <th>Tags</th>
                    <th>Job Title</th>
                    <th>Location</th>
                    <th>Date Applied</th>
                    <th>Status</th>
                    <th>Career Fit</th>
                    <th>Interest</th>
                    <th>Growth</th>
                    <th>Salary Fit</th>
                    <th>Salary Range</th>
                    <th>Total Score</th>
                    <th>Notes</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for job in jobs %}
                <tr>
                    <td>{{ job.id }}</td>
                    <td><strong>{{ job.company_name }}</strong></td>
                    <td>{{ job.job_type }}</td>
                    <td>{{ job.job_title }}</td>
                    <td>{{ job.location }}</td>
                    <td>{{ job.application_date }}</td>
                    <td>{{ job.response_status }}</td>
                    <td>{{ job.career_fit_now }}</td>
                    <td>{{ job.interest_level }}</td>
                    <td>{{ job.growth_potential }}</td>
                    <td>{{ job.salary_fit }}</td>
                    <td>{{ job.salary_range }}</td>
                    <td class="total-score">{{ "%.1f"|format(job.total_score) }}</td>
                    <td class="notes" title="{{ job.notes }}">{{ job.notes }}</td>
                    <td class="actions">
                        <a href="/edit/{{ job.id }}" class="btn btn-edit">Edit</a>
                        <a href="/delete/{{ job.id }}" class="btn btn-delete" 
                           onclick="return confirm('Are you sure you want to delete this job application?')">Delete</a>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    {% else %}
        <div style="text-align: center; padding: 40px; background: white; border-radius: 10px;">
            <h3>No job applications found</h3>
            <p>
                {% if search_query or status_filter != 'all' or score_filter != 'all' %}
                    Try adjusting your search criteria or <a href="/">clear all filters</a>.
                {% else %}
                    <a href="/add" class="btn btn-add">Add Your First Job Application</a>
                {% endif %}
            </p>
        </div>
    {% endif %}
</body>
</html>